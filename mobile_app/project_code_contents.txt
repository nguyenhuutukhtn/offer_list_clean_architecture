### File: lib/firebase_options.dart

// File generated by FlutterFire CLI.
// ignore_for_file: type=lint
import 'package:firebase_core/firebase_core.dart' show FirebaseOptions;
import 'package:flutter/foundation.dart'
    show defaultTargetPlatform, kIsWeb, TargetPlatform;

/// Default [FirebaseOptions] for use with your Firebase apps.
///
/// Example:
/// ```dart
/// import 'firebase_options.dart';
/// // ...
/// await Firebase.initializeApp(
///   options: DefaultFirebaseOptions.currentPlatform,
/// );
/// ```
class DefaultFirebaseOptions {
  static FirebaseOptions get currentPlatform {
    if (kIsWeb) {
      return web;
    }
    switch (defaultTargetPlatform) {
      case TargetPlatform.android:
        return android;
      case TargetPlatform.iOS:
        return ios;
      case TargetPlatform.macOS:
        return macos;
      case TargetPlatform.windows:
        return windows;
      case TargetPlatform.linux:
        throw UnsupportedError(
          'DefaultFirebaseOptions have not been configured for linux - '
          'you can reconfigure this by running the FlutterFire CLI again.',
        );
      default:
        throw UnsupportedError(
          'DefaultFirebaseOptions are not supported for this platform.',
        );
    }
  }

  static const FirebaseOptions web = FirebaseOptions(
    apiKey: 'AIzaSyBiqAe2WCBVdIA3_PC6l8pVNUN-i49ra9k',
    appId: '1:540498827266:web:970c7153e93dc33a03af1b',
    messagingSenderId: '540498827266',
    projectId: 'offer-list-project',
    authDomain: 'offer-list-project.firebaseapp.com',
    storageBucket: 'offer-list-project.appspot.com',
  );

  static const FirebaseOptions android = FirebaseOptions(
    apiKey: 'AIzaSyCyWAYCFHI9dDBbE1y1ps4UFEEJqrmKrog',
    appId: '1:540498827266:android:b9ec112a12e8874403af1b',
    messagingSenderId: '540498827266',
    projectId: 'offer-list-project',
    storageBucket: 'offer-list-project.appspot.com',
  );

  static const FirebaseOptions ios = FirebaseOptions(
    apiKey: 'AIzaSyDRQEq9EqVbwjWYsl2w4Gah-eAoC-y67Ik',
    appId: '1:540498827266:ios:df36d0b37f2ed05b03af1b',
    messagingSenderId: '540498827266',
    projectId: 'offer-list-project',
    storageBucket: 'offer-list-project.appspot.com',
    iosBundleId: 'com.example.mobileApp',
  );

  static const FirebaseOptions macos = FirebaseOptions(
    apiKey: 'AIzaSyDRQEq9EqVbwjWYsl2w4Gah-eAoC-y67Ik',
    appId: '1:540498827266:ios:df36d0b37f2ed05b03af1b',
    messagingSenderId: '540498827266',
    projectId: 'offer-list-project',
    storageBucket: 'offer-list-project.appspot.com',
    iosBundleId: 'com.example.mobileApp',
  );

  static const FirebaseOptions windows = FirebaseOptions(
    apiKey: 'AIzaSyBiqAe2WCBVdIA3_PC6l8pVNUN-i49ra9k',
    appId: '1:540498827266:web:76639330d495420803af1b',
    messagingSenderId: '540498827266',
    projectId: 'offer-list-project',
    authDomain: 'offer-list-project.firebaseapp.com',
    storageBucket: 'offer-list-project.appspot.com',
  );

}

### File: lib/main.dart

import 'package:flutter/material.dart';
import 'package:firebase_core/firebase_core.dart';
import 'package:flutter_bloc/flutter_bloc.dart';
import 'package:mobile_app/core/services/auth_service.dart';
import 'package:mobile_app/domain/entities/offer.dart';
import 'package:mobile_app/domain/usecases/get_purchase_history.dart';
import 'package:mobile_app/presentation/bloc/authentication_bloc.dart';
import 'package:mobile_app/presentation/bloc/offer_bloc.dart';
import 'package:mobile_app/presentation/bloc/purchase_bloc.dart';
import 'package:mobile_app/presentation/bloc/purchase_history_bloc.dart';
import 'package:mobile_app/presentation/pages/login_page.dart';
import 'package:mobile_app/presentation/pages/offer_details_page.dart';
import 'package:mobile_app/presentation/pages/offer_listing_page.dart';
import 'package:mobile_app/presentation/pages/purchase_history_page.dart';
import 'injection_container.dart' as di;
import 'presentation/pages/home_page.dart';
import 'firebase_options.dart';

void main() async {
  WidgetsFlutterBinding.ensureInitialized();
  await Firebase.initializeApp(
    options: DefaultFirebaseOptions.currentPlatform,
  );
  await di.init();
  runApp(MyApp());
}

class MyApp extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return MultiRepositoryProvider(
      providers: [
         RepositoryProvider<AuthService>(
          create: (context) => di.sl<AuthService>(),
        ),
        RepositoryProvider<GetPurchaseHistory>(
          create: (context) => di.sl<GetPurchaseHistory>(),
        ),
      ],
      child: MultiBlocProvider(
        providers: [
          BlocProvider(create: (_) => di.sl<AuthenticationBloc>()),
          BlocProvider(create: (_) => di.sl<OfferBloc>()),
          BlocProvider(create: (_) => di.sl<PurchaseBloc>()),
          BlocProvider(create: (_) => di.sl<PurchaseHistoryBloc>()),
          
        ],
        child: MaterialApp(
          title: 'Offer App',
          theme: ThemeData(
            primarySwatch: Colors.blue,
            visualDensity: VisualDensity.adaptivePlatformDensity,
          ),
          initialRoute: '/',
          routes: {
            '/': (context) => HomePage(),
            '/login': (context) => LoginPage(),
            '/offers': (context) => OfferListingPage(),
            '/purchase_history': (context) => PurchaseHistoryPage(userId: RepositoryProvider.of<AuthService>(context).currentUser?.uid ?? ''),
          },
          onGenerateRoute: (settings) {
            if (settings.name == '/offer_details') {
              final args = settings.arguments as Offer;
              return MaterialPageRoute(
                builder: (context) => OfferDetailsPage(offer: args),
              );
            }
            return null;
          },
          onUnknownRoute: (settings) {
            return MaterialPageRoute(
              builder: (context) => Scaffold(
                body: Center(
                  child: Text('Route not found: ${settings.name}'),
                ),
              ),
            );
          },
        ),
      ),
    );
  }
}

### File: lib/injection_container.dart

import 'package:get_it/get_it.dart';
import 'package:http/http.dart' as http;
import 'package:internet_connection_checker/internet_connection_checker.dart';
import 'package:firebase_auth/firebase_auth.dart';
import 'package:mobile_app/core/database/database_helper.dart';
import 'core/network/network_info.dart';
import 'core/services/auth_service.dart';
import 'data/datasources/offer_remote_data_source.dart';
import 'data/datasources/offer_local_data_source.dart';
import 'data/datasources/purchase_remote_data_source.dart';
import 'data/repositories/offer_repository_impl.dart';
import 'data/repositories/purchase_repository_impl.dart';
import 'domain/repositories/offer_repository.dart';
import 'domain/repositories/purchase_repository.dart';
import 'domain/usecases/get_offers.dart';
import 'domain/usecases/create_offer.dart';
import 'domain/usecases/update_offer.dart';
import 'domain/usecases/delete_offer.dart';
import 'domain/usecases/purchase_offer.dart';
import 'domain/usecases/get_purchase_history.dart';
import 'presentation/bloc/offer_bloc.dart';
import 'presentation/bloc/purchase_bloc.dart';
import 'presentation/bloc/purchase_history_bloc.dart';
import 'presentation/bloc/authentication_bloc.dart';

final sl = GetIt.instance;

const BASE_DOMAIN = const String.fromEnvironment("API_URL", defaultValue: "http://localhost:3000");


Future<void> init() async {
  // Use cases
  sl.registerLazySingleton(() => GetOffers(sl()));
  sl.registerLazySingleton(() => CreateOffer(sl()));
  sl.registerLazySingleton(() => UpdateOffer(sl()));
  sl.registerLazySingleton(() => DeleteOffer(sl()));
  sl.registerLazySingleton(() => PurchaseOffer(sl()));
  sl.registerLazySingleton(() => GetPurchaseHistory(sl()));

  // BLoCs
  sl.registerFactory(() => OfferBloc(
        getOffers: sl(),
        createOffer: sl(),
        updateOffer: sl(),
        deleteOffer: sl(),
      ));
  sl.registerFactory(() => PurchaseBloc(purchaseOffer: sl()));
  sl.registerFactory(() => PurchaseHistoryBloc(getPurchaseHistory: sl()));
  sl.registerFactory(() => AuthenticationBloc(authService: sl()));

  // Repositories
  sl.registerLazySingleton<OfferRepository>(
    () => OfferRepositoryImpl(
      remoteDataSource: sl(),
      // localDataSource: sl(),
      networkInfo: sl(),
    ),
  );
  sl.registerLazySingleton<PurchaseRepository>(
    () => PurchaseRepositoryImpl(
      remoteDataSource: sl(),
      networkInfo: sl(),
    ),
  );

  // Data sources
  sl.registerLazySingleton<OfferRemoteDataSource>(
    () => OfferRemoteDataSourceImpl(
        client: sl(), authService: sl(), baseUrl: BASE_DOMAIN),
  );
  // sl.registerLazySingleton<OfferLocalDataSource>(
  //   () => OfferLocalDataSourceImpl(databaseHelper: sl()),
  // );
  sl.registerLazySingleton<PurchaseRemoteDataSource>(
    () => PurchaseRemoteDataSourceImpl(
        client: sl(), authService: sl(), baseUrl: BASE_DOMAIN),
  );

  // Core
  sl.registerLazySingleton<NetworkInfo>(() => NetworkInfoImpl(sl()));
  sl.registerLazySingleton(() => AuthService(sl()));
  sl.registerLazySingleton(() => DatabaseHelper.instance);

  // External
  sl.registerLazySingleton(() => http.Client());
  sl.registerLazySingleton(() => InternetConnectionChecker());
  sl.registerLazySingleton(() => FirebaseAuth.instance);
}


### File: lib/core/database/database_helper.dart

import 'package:sqflite/sqflite.dart';
import 'package:path/path.dart';

class DatabaseHelper {
  static final DatabaseHelper instance = DatabaseHelper._init();
  static Database? _database;

  DatabaseHelper._init();

  Future<Database> get database async {
    if (_database != null) return _database!;
    _database = await _initDB('offers.db');
    return _database!;
  }

  Future<Database> _initDB(String filePath) async {
    final dbPath = await getDatabasesPath();
    final path = join(dbPath, filePath);

    return await openDatabase(path, version: 1, onCreate: _createDB);
  }

  Future<void> _createDB(Database db, int version) async {
    await db.execute('''
      CREATE TABLE offers(
        id TEXT PRIMARY KEY,
        title TEXT NOT NULL,
        description TEXT NOT NULL,
        discountPercentage REAL NOT NULL,
        originalPrice REAL NOT NULL,
        discountedPrice REAL NOT NULL
      )
    ''');
  }
}

### File: lib/core/network/network_info.dart

import 'package:internet_connection_checker/internet_connection_checker.dart';

abstract class NetworkInfo {
  Future<bool> get isConnected;
}

class NetworkInfoImpl implements NetworkInfo {
  final InternetConnectionChecker connectionChecker;

  NetworkInfoImpl(this.connectionChecker);

  @override
  Future<bool> get isConnected => connectionChecker.hasConnection;
}

### File: lib/core/utils/snackbar_util.dart

import 'package:flutter/material.dart';

class SnackbarUtil {
  static void showErrorSnackbar(BuildContext context, String message) {
    ScaffoldMessenger.of(context).showSnackBar(
      SnackBar(
        content: Text(message),
        backgroundColor: Colors.red,
        duration: Duration(seconds: 3),
      ),
    );
  }

  static void showSuccessSnackbar(BuildContext context, String message) {
    ScaffoldMessenger.of(context).showSnackBar(
      SnackBar(
        content: Text(message),
        backgroundColor: Colors.green,
        duration: Duration(seconds: 3),
      ),
    );
  }
}

### File: lib/core/error/exceptions.dart

class ServerException implements Exception {
  final String message;

  ServerException([this.message = 'An error occurred while communicating with the server']);

  @override
  String toString() => 'ServerException: $message';
}

class CacheException implements Exception {
  final String message;

  CacheException([this.message = 'An error occurred while accessing the cache']);

  @override
  String toString() => 'CacheException: $message';
}

class NetworkException implements Exception {
  final String message;

  NetworkException([this.message = 'A network error occurred']);

  @override
  String toString() => 'NetworkException: $message';
}

class ValidationException implements Exception {
  final String message;

  ValidationException([this.message = 'A validation error occurred']);

  @override
  String toString() => 'ValidationException: $message';
}

class NotFoundException implements Exception {
  final String message;

  NotFoundException([this.message = 'The requested resource was not found']);

  @override
  String toString() => 'NotFoundException: $message';
}

class PurchaseException implements Exception {
  final String message;

  PurchaseException([this.message = 'An error occurred during the purchase process']);

  @override
  String toString() => 'PurchaseException: $message';
}

class AuthenticationException implements Exception {
  final String message;

  AuthenticationException([this.message = 'An authentication error occurred']);

  @override
  String toString() => 'AuthenticationException: $message';
}

### File: lib/core/error/failures.dart

import 'package:equatable/equatable.dart';

abstract class Failure extends Equatable {
  final String message;

  const Failure(this.message);

  @override
  List<Object> get props => [message];
}

class ServerFailure extends Failure {
  const ServerFailure([String message = 'Server failure']) : super(message);
}

class NetworkFailure extends Failure {
  const NetworkFailure([String message = 'Network failure']) : super(message);
}

class ValidationFailure extends Failure {
  const ValidationFailure(String message) : super(message);
}

class AuthenticationFailure extends Failure {
  const AuthenticationFailure([String message = 'Authentication failure']) : super(message);
}

class CacheFailure extends Failure {
  const CacheFailure([String message = 'Cache failure']) : super(message);
}

class PurchaseFailure extends Failure {
  const PurchaseFailure([String message = 'Purchase failure']) : super(message);
}

### File: lib/core/usecases/usecase.dart

import 'package:dartz/dartz.dart';
import 'package:equatable/equatable.dart';
import '../error/failures.dart';

abstract class UseCase<Type, Params> {
  Future<Either<Failure, Type>> call(Params params);
}

class NoParams extends Equatable {
  @override
  List<Object> get props => [];
}

### File: lib/core/services/auth_service.dart

import 'package:firebase_auth/firebase_auth.dart';
import 'package:shared_preferences/shared_preferences.dart';

class AuthService {
  final FirebaseAuth _firebaseAuth;

  AuthService(this._firebaseAuth);

  Stream<User?> get authStateChanges => _firebaseAuth.authStateChanges();

  static const String _tokenKey = 'auth_token';

  Future<void> saveToken(String token) async {
    final prefs = await SharedPreferences.getInstance();
    await prefs.setString(_tokenKey, token);
  }

  Future<String?> getToken() async {
    final prefs = await SharedPreferences.getInstance();
    return prefs.getString(_tokenKey);
  }

  Future<void> deleteToken() async {
    final prefs = await SharedPreferences.getInstance();
    await prefs.remove(_tokenKey);
  }

  Future<bool> checkAndSignInWithToken() async {
    final token = await getToken();
    if (token != null) {
      return true;
    }
    return false;
  }

  Future<void> signIn(String email, String password) async {
    try {
      await _firebaseAuth.signInWithEmailAndPassword(email: email, password: password).then((value) async {
        final idToken = await value.user!.getIdToken();
        if (idToken != null) {
          await saveToken(idToken);
        }
      });
      
    } on FirebaseAuthException catch (e) {
      throw _handleFirebaseAuthException(e);
    }
  }

  Future<void> signUp(String email, String password) async {
    try {
      await _firebaseAuth.createUserWithEmailAndPassword(email: email, password: password);
    } on FirebaseAuthException catch (e) {
      throw _handleFirebaseAuthException(e);
    }
  }

  Future<void> signOut() async {
    await _firebaseAuth.signOut();
  }

  User? get currentUser => _firebaseAuth.currentUser;

  String _handleFirebaseAuthException(FirebaseAuthException e) {
    switch (e.code) {
      case 'weak-password':
        return 'The password provided is too weak.';
      case 'email-already-in-use':
        return 'The account already exists for that email.';
      case 'user-not-found':
        return 'No user found for that email.';
      case 'wrong-password':
        return 'Wrong password provided for that user.';
      default:
        return 'An error occurred. Please try again.';
    }
  }
}

### File: lib/data/datasources/offer_remote_data_source.dart

import 'dart:convert';
import 'package:http/http.dart' as http;
import 'package:mobile_app/core/services/auth_service.dart';
import '../../core/error/exceptions.dart';
import '../../domain/entities/offer.dart';
import '../models/offer_model.dart';

abstract class OfferRemoteDataSource {
  Future<List<OfferModel>> getOffers();
  Future<OfferModel> createOffer(OfferModel offer);
  Future<OfferModel> updateOffer(OfferModel offer);
  Future<void> deleteOffer(String offerId);
  Future<void> purchaseOffer(Offer offer, String userId);
}

class OfferRemoteDataSourceImpl implements OfferRemoteDataSource {
  final http.Client client;
  final String baseUrl;
   final AuthService authService;

  OfferRemoteDataSourceImpl( {required this.client, required this.baseUrl, required this.authService});

   Future<Map<String, String>> _getHeaders() async {
    final token = await authService.getToken();
    return {
      'Content-Type': 'application/json',
      'Authorization': 'Bearer $token',
    };
  }

  @override
  Future<List<OfferModel>> getOffers() async {
    final response = await client.get(
      Uri.parse('$baseUrl/api/offers'),
      headers: await _getHeaders(),
    );

    if (response.statusCode == 200) {
      final List<dynamic> offersJson = json.decode(response.body);
      return offersJson.map((json) => OfferModel.fromJson(json)).toList();
    } else {
      throw ServerException();
    }
  }

  @override
  Future<OfferModel> createOffer(OfferModel offer) async {
    final response = await client.post(
      Uri.parse('$baseUrl/api/offers'),
      headers: await _getHeaders(),
      body: json.encode(offer.toJson()),
    );


    if (response.statusCode == 201) {
      return OfferModel.fromJson(json.decode(response.body));
    } else {
      throw ServerException();
    }
  }

  @override
  Future<OfferModel> updateOffer(OfferModel offer) async {
    final response = await client.put(
      Uri.parse('$baseUrl/api/offers/${offer.id}'),
      headers: await _getHeaders(),
      body: json.encode(offer.toJson()),
    );

    if (response.statusCode == 200) {
      return OfferModel.fromJson(json.decode(response.body));
    } else {
      throw ServerException();
    }
  }

  @override
  Future<void> deleteOffer(String offerId) async {
    final response = await client.delete(
      Uri.parse('$baseUrl/api/offers/$offerId'),
      headers: await _getHeaders(),
    );

    if (response.statusCode != 204) {
      throw ServerException();
    }
  }

  @override
  Future<void> purchaseOffer(Offer offer, String userId) async {
    final response = await client.post(
      Uri.parse('$baseUrl/api/offers/${offer.id}/purchase'),
      headers: await _getHeaders(),
      body: json.encode({
        'userId': userId,
        'offerId': offer.id,
      }),
    );

    if (response.statusCode == 200) {
      return;
    } else if (response.statusCode == 400) {
      throw ValidationException(json.decode(response.body)['message']);
    } else if (response.statusCode == 404) {
      throw NotFoundException('Offer not found');
    } else {
      throw ServerException();
    }
  }
}

### File: lib/data/datasources/offer_local_data_source.dart

// import 'package:mobile_app/core/database/database_helper.dart';
// import 'package:mobile_app/core/error/exceptions.dart';
// import 'package:sqflite/sqflite.dart';
// import '../models/offer_model.dart';

// abstract class OfferLocalDataSource {
//   Future<List<OfferModel>> getCachedOffers();
//   Future<void> cacheOffers(List<OfferModel> offers);
// }

// class OfferLocalDataSourceImpl implements OfferLocalDataSource {
//   final DatabaseHelper databaseHelper;

//   OfferLocalDataSourceImpl({required this.databaseHelper});

//   @override
//   Future<List<OfferModel>> getCachedOffers() async {
//     try {
//       final db = await databaseHelper.database;
//       final maps = await db.query('offers');
//       return List.generate(maps.length, (i) => OfferModel.fromJson(maps[i]));
//     } catch (e) {
//       throw CacheException();
//     }
//   }

//   @override
//   Future<void> cacheOffers(List<OfferModel> offers) async {
//     try {
//       final db = await databaseHelper.database;
//       await db.transaction((txn) async {
//         await txn.delete('offers');
//         for (var offer in offers) {
//           await txn.insert('offers', offer.toJson());
//         }
//       });
//     } catch (e) {
//       throw CacheException();
//     }
//   }
// }

### File: lib/data/datasources/purchase_remote_data_source.dart

import 'dart:convert';
import 'package:http/http.dart' as http;
import 'package:mobile_app/core/services/auth_service.dart';
import '../../core/error/exceptions.dart';
import '../models/purchase_history_model.dart';

abstract class PurchaseRemoteDataSource {
  Future<List<PurchaseHistoryModel>> getPurchaseHistory(String userId);
}

class PurchaseRemoteDataSourceImpl implements PurchaseRemoteDataSource {
  final http.Client client;
  final String baseUrl;
  final AuthService authService;

  PurchaseRemoteDataSourceImpl({required this.client, required this.baseUrl, required this.authService, });

  Future<Map<String, String>> _getHeaders() async {
    final token = await authService.getToken();
    return {
      'Content-Type': 'application/json',
      'Authorization': 'Bearer $token',
    };
  }

  @override
  Future<List<PurchaseHistoryModel>> getPurchaseHistory(String userId) async {
    final response = await client.get(
      Uri.parse('$baseUrl/api/offers/history/$userId'),
      headers: await _getHeaders(),
    );

    if (response.statusCode == 200) {
      final List<dynamic> purchaseHistoryJson = json.decode(response.body);
      return purchaseHistoryJson.map((json) => PurchaseHistoryModel.fromJson(json)).toList();
    } else {

      throw ServerException();
    }
  }
}

### File: lib/data/repositories/purchase_repository_impl.dart

import 'package:dartz/dartz.dart';
import 'package:mobile_app/data/datasources/purchase_remote_data_source.dart';
import '../../domain/entities/purchase_history.dart';
import '../../domain/repositories/purchase_repository.dart';
import '../../core/error/failures.dart';
import '../../core/error/exceptions.dart';
import '../../core/network/network_info.dart';

class PurchaseRepositoryImpl implements PurchaseRepository {
  final PurchaseRemoteDataSource remoteDataSource;
  final NetworkInfo networkInfo;

  PurchaseRepositoryImpl({
    required this.remoteDataSource,
    required this.networkInfo,
  });

  @override
  Future<Either<Failure, List<PurchaseHistory>>> getPurchaseHistory(String userId) async {
    if (await networkInfo.isConnected) {
      try {
        final purchaseHistory = await remoteDataSource.getPurchaseHistory(userId);
        return Right(purchaseHistory);
      } on ServerException {
        return Left(ServerFailure());
      }
    } else {
      return Left(NetworkFailure());
    }
  }
}

### File: lib/data/repositories/offer_repository_impl.dart

import 'package:dartz/dartz.dart';
import 'package:mobile_app/core/network/network_info.dart';
import 'package:mobile_app/data/datasources/offer_local_data_source.dart';
import 'package:mobile_app/data/models/offer_model.dart';
import '../../domain/entities/offer.dart';
import '../../domain/repositories/offer_repository.dart';
import '../datasources/offer_remote_data_source.dart';
import '../../core/error/failures.dart';
import '../../core/error/exceptions.dart';


class OfferRepositoryImpl implements OfferRepository {
  final OfferRemoteDataSource remoteDataSource;
  // final OfferLocalDataSource localDataSource;
  final NetworkInfo networkInfo;


  OfferRepositoryImpl({
    required this.remoteDataSource,
    // required this.localDataSource,
    required this.networkInfo,
  });

  @override
  Future<Either<Failure, List<Offer>>> getOffers() async {
    if (await _isConnected()) {
      try {
        final remoteOffers = await remoteDataSource.getOffers();
        // localDataSource.cacheOffers(remoteOffers);
        return Right(remoteOffers);
      } on ServerException {
        return Left(ServerFailure());
      }
    } else {
      // try {
      //   final localOffers = await localDataSource.getCachedOffers();
      //   return Right(localOffers);
      // } on CacheException {
      //   return Left(CacheFailure());
      // }
      return Left(NetworkFailure());
    }
  }

  @override
  Future<Either<Failure, Offer>> createOffer(Offer offer) async {
    if (await _isConnected()) {
      try {
        // Convert Offer to OfferModel
        final offerModel = OfferModel(
          id: offer.id,
          title: offer.title,
          description: offer.description,
          discountPercentage: offer.discountPercentage,
          originalPrice: offer.originalPrice,
          discountedPrice: offer.discountedPrice,
        );
        
        final remoteOffer = await remoteDataSource.createOffer(offerModel);
        return Right(remoteOffer);
      } on ServerException {
        return Left(ServerFailure());
      }
    } else {
      return Left(NetworkFailure());
    }
  }

  @override
  Future<Either<Failure, Offer>> updateOffer(Offer offer) async {
    if (await _isConnected()) {
      try {
        
        final offerModel = OfferModel(
          id: offer.id,
          title: offer.title,
          description: offer.description,
          discountPercentage: offer.discountPercentage,
          originalPrice: offer.originalPrice,
          discountedPrice: offer.discountedPrice,
        );
        final updatedOffer = await remoteDataSource.updateOffer(offerModel);
        return Right(updatedOffer);
      } on ServerException {
        return Left(ServerFailure());
      }
    } else {
      return Left(NetworkFailure());
    }
  }

  @override
  Future<Either<Failure, void>> deleteOffer(String offerId) async {
    if (await _isConnected()) {
      try {
        await remoteDataSource.deleteOffer(offerId);
        return Right(null);
      } on ServerException {
        return Left(ServerFailure());
      }
    } else {
      return Left(NetworkFailure());
    }
  }

  @override
  Future<Either<Failure, void>> purchaseOffer(Offer offer, String userId) async {
    if (await networkInfo.isConnected) {
      try {
        await remoteDataSource.purchaseOffer(offer, userId);
        return Right(null);
      } on ServerException {
        return Left(ServerFailure());
      } on PurchaseException {
        return Left(PurchaseFailure());
      }
    } else {
      return Left(NetworkFailure());
    }
  }

  

  Future<bool> _isConnected() async {
    return await networkInfo.isConnected;
  }
}

### File: lib/data/models/purchase_history_model.dart

import '../../domain/entities/purchase_history.dart';
import 'offer_model.dart';

class PurchaseHistoryModel extends PurchaseHistory {
  PurchaseHistoryModel({
    required String id,
    required String userId,
    required OfferModel offer,
    required DateTime purchaseDate,
  }) : super(
          id: id,
          userId: userId,
          offer: offer,
          purchaseDate: purchaseDate,
        );

  factory PurchaseHistoryModel.fromJson(Map<String, dynamic> json) {
    return PurchaseHistoryModel(
      id: json['id'],
      userId: json['userId'],
      offer: OfferModel.fromJson(json['offer']),
      purchaseDate: DateTime.parse(json['purchaseDate']),
    );
  }

  Map<String, dynamic> toJson() {
    return {
      'id': id,
      'userId': userId,
      'offer': (offer as OfferModel).toJson(),
      'purchaseDate': purchaseDate.toIso8601String(),
    };
  }
}

### File: lib/data/models/offer_model.dart

import '../../domain/entities/offer.dart';

class OfferModel extends Offer {
  OfferModel({
    required String id,
    required String title,
    required String description,
    required double discountPercentage,
    required double originalPrice,
    required double discountedPrice,
  }) : super(
          id: id,
          title: title,
          description: description,
          discountPercentage: discountPercentage,
          originalPrice: originalPrice,
          discountedPrice: discountedPrice,
        );

  factory OfferModel.fromJson(Map<String, dynamic> json) {
    return OfferModel(
      id: json['id'],
      title: json['title'],
      description: json['description'],
      discountPercentage: json['discountPercentage'].toDouble(),
      originalPrice: json['originalPrice'].toDouble(),
      discountedPrice: json['discountedPrice'].toDouble(),
    );
  }

  Map<String, dynamic> toJson() {
    return {
      'id': id,
      'title': title,
      'description': description,
      'discountPercentage': discountPercentage,
      'originalPrice': originalPrice,
      'discountedPrice': discountedPrice,
    };
  }
}

### File: lib/domain/repositories/offer_repository.dart

import 'package:dartz/dartz.dart';
import '../entities/offer.dart';
import '../../core/error/failures.dart';

abstract class OfferRepository {
  Future<Either<Failure, List<Offer>>> getOffers();
  Future<Either<Failure, Offer>> createOffer(Offer offer);
 Future<Either<Failure, Offer>> updateOffer(Offer offer);
  Future<Either<Failure, void>> deleteOffer(String offerId);
   Future<Either<Failure, void>> purchaseOffer(Offer offer, String userId);
}

### File: lib/domain/repositories/purchase_repository.dart

import 'package:dartz/dartz.dart';
import '../entities/purchase_history.dart';
import '../../core/error/failures.dart';

abstract class PurchaseRepository {
  Future<Either<Failure, List<PurchaseHistory>>> getPurchaseHistory(String userId);
}

### File: lib/domain/usecases/update_offer.dart

import 'package:dartz/dartz.dart';
import '../entities/offer.dart';
import '../repositories/offer_repository.dart';
import '../../core/error/failures.dart';
import '../../core/usecases/usecase.dart';

class UpdateOffer implements UseCase<Offer, UpdateOfferParams> {
  final OfferRepository repository;

  UpdateOffer(this.repository);

  @override
  Future<Either<Failure, Offer>> call(UpdateOfferParams params) async {
    if (params.offer.title.isEmpty) {
      return Left(ValidationFailure('Title cannot be empty'));
    }
    if (params.offer.description.isEmpty) {
      return Left(ValidationFailure('Description cannot be empty'));
    }
    if (params.offer.discountPercentage < 0 || params.offer.discountPercentage > 100) {
      return Left(ValidationFailure('Discount percentage must be between 0 and 100'));
    }
    if (params.offer.originalPrice <= 0) {
      return Left(ValidationFailure('Original price must be greater than 0'));
    }
    if (params.offer.discountedPrice <= 0 || params.offer.discountedPrice >= params.offer.originalPrice) {
      return Left(ValidationFailure('Discounted price must be greater than 0 and less than the original price'));
    }
    return await repository.updateOffer(params.offer);
  }
}

class UpdateOfferParams {
  final Offer offer;

  UpdateOfferParams(this.offer);
}

### File: lib/domain/usecases/delete_offer.dart

import 'package:dartz/dartz.dart';
import '../repositories/offer_repository.dart';
import '../../core/error/failures.dart';
import '../../core/usecases/usecase.dart';

class DeleteOffer implements UseCase<void, String> {
  final OfferRepository repository;

  DeleteOffer(this.repository);

  @override
  Future<Either<Failure, void>> call(String offerId) async {
    return await repository.deleteOffer(offerId);
  }
}

### File: lib/domain/usecases/create_offer.dart

import 'package:dartz/dartz.dart';
import '../entities/offer.dart';
import '../repositories/offer_repository.dart';
import '../../core/error/failures.dart';
import '../../core/usecases/usecase.dart';

class CreateOffer implements UseCase<Offer, CreateOfferParams> {
  final OfferRepository repository;

  CreateOffer(this.repository);

  @override
  Future<Either<Failure, Offer>> call(CreateOfferParams params) async {
    if (params.offer.title.isEmpty) {
      return Left(ValidationFailure('Title cannot be empty'));
    }
    if (params.offer.description.isEmpty) {
      return Left(ValidationFailure('Description cannot be empty'));
    }
    if (params.offer.discountPercentage < 0 || params.offer.discountPercentage > 100) {
      return Left(ValidationFailure('Discount percentage must be between 0 and 100'));
    }
    if (params.offer.originalPrice <= 0) {
      return Left(ValidationFailure('Original price must be greater than 0'));
    }
    if (params.offer.discountedPrice <= 0 || params.offer.discountedPrice >= params.offer.originalPrice) {
      return Left(ValidationFailure('Discounted price must be greater than 0 and less than the original price'));
    }

    return await repository.createOffer(params.offer);
  }
}

class CreateOfferParams {
  final Offer offer;

  CreateOfferParams(this.offer);
}

### File: lib/domain/usecases/get_purchase_history.dart

import 'package:dartz/dartz.dart';
import '../entities/purchase_history.dart';
import '../repositories/purchase_repository.dart';
import '../../core/error/failures.dart';
import '../../core/usecases/usecase.dart';

class GetPurchaseHistory implements UseCase<List<PurchaseHistory>, String> {
  final PurchaseRepository repository;

  GetPurchaseHistory(this.repository);

  @override
  Future<Either<Failure, List<PurchaseHistory>>> call(String userId) async {
    return await repository.getPurchaseHistory(userId);
  }
}

### File: lib/domain/usecases/get_offers.dart

import 'package:dartz/dartz.dart';
import '../entities/offer.dart';
import '../repositories/offer_repository.dart';
import '../../core/error/failures.dart';
import '../../core/usecases/usecase.dart';

class GetOffers implements UseCase<List<Offer>, NoParams> {
  final OfferRepository repository;

  GetOffers(this.repository);

  @override
  Future<Either<Failure, List<Offer>>> call(NoParams params) async {
    return await repository.getOffers();
  }
}

### File: lib/domain/usecases/purchase_offer.dart

import 'package:dartz/dartz.dart';
import '../entities/offer.dart';
import '../repositories/offer_repository.dart';
import '../../core/error/failures.dart';
import '../../core/usecases/usecase.dart';

class PurchaseOffer implements UseCase<void, PurchaseOfferParams> {
  final OfferRepository repository;

  PurchaseOffer(this.repository);

  @override
  Future<Either<Failure, void>> call(PurchaseOfferParams params) async {
    return await repository.purchaseOffer(params.offer, params.userId);
  }
}

class PurchaseOfferParams {
  final Offer offer;
  final String userId;

  PurchaseOfferParams(this.offer, this.userId);
}

### File: lib/domain/entities/purchase_history.dart

import 'package:equatable/equatable.dart';
import 'offer.dart';

class PurchaseHistory extends Equatable {
  final String id;
  final String userId;
  final Offer offer;
  final DateTime purchaseDate;

  PurchaseHistory({
    required this.id,
    required this.userId,
    required this.offer,
    required this.purchaseDate,
  });

  @override
  List<Object> get props => [id, userId, offer, purchaseDate];
}

### File: lib/domain/entities/offer.dart

class Offer {
  final String id;
  final String title;
  final String description;
  final double discountPercentage;
  final double originalPrice;
  final double discountedPrice;

  Offer({
    required this.id,
    required this.title,
    required this.description,
    required this.discountPercentage,
    required this.originalPrice,
    required this.discountedPrice,
  });

  factory Offer.empty() {
    return Offer(
      id: '',
      title: '',
      description: '',
      discountPercentage: 0,
      originalPrice: 0,
      discountedPrice: 0,
    );
  }
}

### File: lib/presentation/pages/purchase_history_page.dart

import 'package:flutter/material.dart';
import 'package:flutter_bloc/flutter_bloc.dart';
import '../bloc/purchase_history_bloc.dart';
import '../../domain/entities/purchase_history.dart';
import 'package:intl/intl.dart';

class PurchaseHistoryPage extends StatelessWidget {
  final String userId;

  const PurchaseHistoryPage({Key? key, required this.userId}) : super(key: key);

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: Text('Purchase History'),
        backgroundColor: Colors.blue,
        foregroundColor: Colors.white,
        elevation: 0,
      ),
      body: BlocProvider(
        create: (context) => PurchaseHistoryBloc(
          getPurchaseHistory: RepositoryProvider.of(context),
        )..add(GetPurchaseHistoryEvent(userId)),
        child: BlocBuilder<PurchaseHistoryBloc, PurchaseHistoryState>(
          builder: (context, state) {
            if (state is PurchaseHistoryLoading) {
              return Center(child: CircularProgressIndicator());
            } else if (state is PurchaseHistoryLoaded) {
              return state.purchaseHistory.isEmpty
                  ? _buildEmptyState()
                  : _buildPurchaseList(state.purchaseHistory, context);
            } else if (state is PurchaseHistoryError) {
              return _buildErrorState(state.message);
            }
            return _buildEmptyState();
          },
        ),
      ),
    );
  }

  Widget _buildEmptyState() {
    return Center(
      child: Column(
        mainAxisAlignment: MainAxisAlignment.center,
        children: [
          Icon(Icons.history, size: 80, color: Colors.grey),
          SizedBox(height: 16),
          Text(
            'No purchase history available',
            style: TextStyle(fontSize: 18, color: Colors.grey),
          ),
        ],
      ),
    );
  }

  Widget _buildErrorState(String message) {
    return Center(
      child: Column(
        mainAxisAlignment: MainAxisAlignment.center,
        children: [
          Icon(Icons.error_outline, size: 80, color: Colors.red),
          SizedBox(height: 16),
          Text(
            'Error loading purchase history',
            style: TextStyle(fontSize: 18, color: Colors.red),
          ),
          SizedBox(height: 8),
          Text(
            message,
            style: TextStyle(fontSize: 14, color: Colors.red),
            textAlign: TextAlign.center,
          ),
        ],
      ),
    );
  }

  Widget _buildPurchaseList(List<PurchaseHistory> purchaseHistory, BuildContext context) {
    return RefreshIndicator(
      onRefresh: () async {
        BlocProvider.of<PurchaseHistoryBloc>(context).add(GetPurchaseHistoryEvent(userId));
      },
      child: ListView.builder(
        itemCount: purchaseHistory.length,
        itemBuilder: (context, index) {
          return PurchaseHistoryItem(purchaseHistory: purchaseHistory[index]);
        },
      ),
    );
  }
}

class PurchaseHistoryItem extends StatelessWidget {
  final PurchaseHistory purchaseHistory;

  const PurchaseHistoryItem({Key? key, required this.purchaseHistory}) : super(key: key);

  @override
  Widget build(BuildContext context) {
    return Card(
      margin: EdgeInsets.symmetric(horizontal: 16, vertical: 8),
      elevation: 2,
      shape: RoundedRectangleBorder(
        borderRadius: BorderRadius.circular(12),
      ),
      child: ExpansionTile(
        title: Text(
          purchaseHistory.offer.title,
          style: TextStyle(fontWeight: FontWeight.bold),
        ),
        subtitle: Text(
          'Purchased on ${DateFormat('MMM dd, yyyy').format(purchaseHistory.purchaseDate)}',
          style: TextStyle(color: Colors.grey[600]),
        ),
        trailing: Text(
          '\$${purchaseHistory.offer.discountedPrice.toStringAsFixed(2)}',
          style: TextStyle(
            fontWeight: FontWeight.bold,
            color: Colors.green,
          ),
        ),
        children: [
          Padding(
            padding: const EdgeInsets.all(16.0),
            child: Column(
              crossAxisAlignment: CrossAxisAlignment.start,
              children: [
                Text(
                  'Offer Details:',
                  style: TextStyle(fontWeight: FontWeight.bold),
                ),
                SizedBox(height: 8),
                Text(purchaseHistory.offer.description),
                SizedBox(height: 8),
                Row(
                  mainAxisAlignment: MainAxisAlignment.spaceBetween,
                  children: [
                    Text('Original Price:'),
                    Text(
                      '\$${purchaseHistory.offer.originalPrice.toStringAsFixed(2)}',
                      style: TextStyle(
                        decoration: TextDecoration.lineThrough,
                        color: Colors.grey,
                      ),
                    ),
                  ],
                ),
                Row(
                  mainAxisAlignment: MainAxisAlignment.spaceBetween,
                  children: [
                    Text('Discount:'),
                    Text(
                      '${purchaseHistory.offer.discountPercentage.toStringAsFixed(0)}%',
                      style: TextStyle(color: Colors.red),
                    ),
                  ],
                ),
                Row(
                  mainAxisAlignment: MainAxisAlignment.spaceBetween,
                  children: [
                    Text('You Saved:'),
                    Text(
                      '\$${(purchaseHistory.offer.originalPrice - purchaseHistory.offer.discountedPrice).toStringAsFixed(2)}',
                      style: TextStyle(color: Colors.green),
                    ),
                  ],
                ),
              ],
            ),
          ),
        ],
      ),
    );
  }
}

### File: lib/presentation/pages/offer_listing_page.dart

import 'package:flutter/material.dart';
import 'package:flutter_bloc/flutter_bloc.dart';
import 'package:mobile_app/core/utils/snackbar_util.dart';
import 'package:mobile_app/presentation/bloc/offer_event.dart';
import 'package:mobile_app/presentation/bloc/offer_state.dart';
import 'package:mobile_app/presentation/pages/offer_details_page.dart';
import '../../core/services/auth_service.dart';
import '../bloc/offer_bloc.dart';
import '../widgets/offer_card.dart';
import '../widgets/offer_form.dart';
import '../widgets/app_drawer.dart';

class OfferListingPage extends StatefulWidget {
  @override
  State<OfferListingPage> createState() => _OfferListingPageState();
}

class _OfferListingPageState extends State<OfferListingPage> {
  late AuthService authService;

  @override
  void initState() {
    super.initState();
    authService = RepositoryProvider.of<AuthService>(context);
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: Text('Special Offers',
            style: TextStyle(fontWeight: FontWeight.bold)),
        backgroundColor: Colors.blue,
        foregroundColor: Colors.white,
        elevation: 0,
        actions: [
          IconButton(
            icon: Icon(Icons.refresh),
            onPressed: () {
              BlocProvider.of<OfferBloc>(context).add(GetOffersEvent());
            },
          ),
        ],
      ),
      drawer: AppDrawer(authService: authService),
      body: BlocConsumer<OfferBloc, OfferState>(
        listener: (context, state) {
          if (state is OfferError) {
            SnackbarUtil.showErrorSnackbar(context, state.message);
          } else if (state is OfferCreated || state is OfferUpdated) {
            SnackbarUtil.showSuccessSnackbar(
                context, 'Offer saved successfully');
          } else if (state is OfferDeleted) {
            SnackbarUtil.showSuccessSnackbar(
                context, 'Offer deleted successfully');
          }
        },
        builder: (context, state) {
          if (state is OfferInitial) {
            BlocProvider.of<OfferBloc>(context).add(GetOffersEvent());
            return Center(child: CircularProgressIndicator());
          } else if (state is OfferLoading) {
            return Center(child: CircularProgressIndicator());
          } else if (state is OfferLoaded) {
            return RefreshIndicator(
              onRefresh: () async {
                BlocProvider.of<OfferBloc>(context).add(GetOffersEvent());
              },
              child: LayoutBuilder(
                builder: (context, constraints) {
                  if (constraints.maxWidth < 600) {
                    // Mobile layout
                    return ListView.builder(
                      itemCount: state.offers.length,
                      itemBuilder: (context, index) {
                        return Padding(
                          padding: const EdgeInsets.symmetric(
                              horizontal: 16, vertical: 8),
                          child: OfferCard(
                            offer: state.offers[index],
                            onTap: () {
                              Navigator.push(
                                  context,
                                  MaterialPageRoute(
                                      builder: (context) => OfferDetailsPage(
                                            offer: state.offers[index],
                                          )));
                            },
                          ),
                        );
                      },
                    );
                  } else {
                    // Web/tablet layout
                    return GridView.builder(
                      padding: EdgeInsets.all(16),
                      
                      gridDelegate: SliverGridDelegateWithFixedCrossAxisCount(
                        crossAxisCount: constraints.maxWidth > 900 ? 3 : 2,
                        childAspectRatio: constraints.maxWidth > 900 ? 2.2 : 1.4,
                        crossAxisSpacing: 16,
                        mainAxisSpacing: 16,
                      ),
                      itemCount: state.offers.length,
                      
                      itemBuilder: (context, index) {
                        return OfferCard(
                          offer: state.offers[index],
                          onTap: () {
                            Navigator.push(
                                context,
                                MaterialPageRoute(
                                    builder: (context) => OfferDetailsPage(
                                          offer: state.offers[index],
                                        )));
                          },
                        );
                      },
                    );
                  }
                },
              ),
            );
          } else if (state is OfferError) {
            return Center(
              child: Column(
                mainAxisAlignment: MainAxisAlignment.center,
                children: [
                  Icon(Icons.error_outline, size: 60, color: Colors.red),
                  SizedBox(height: 16),
                  Text(
                    'Oops! Something went wrong.',
                    style: TextStyle(fontSize: 18),
                  ),
                  SizedBox(height: 8),
                  Text(
                    state.message,
                    style: TextStyle(fontSize: 14, color: Colors.red),
                    textAlign: TextAlign.center,
                  ),
                  SizedBox(height: 16),
                  ElevatedButton(
                    onPressed: () {
                      BlocProvider.of<OfferBloc>(context).add(GetOffersEvent());
                    },
                    child: Text('Try Again'),
                  ),
                ],
              ),
            );
          }
          return Center(child: Text('No offers available'));
        },
      ),
      floatingActionButton: FloatingActionButton(
        onPressed: () {
          _showOfferForm(context);
        },
        child: Icon(Icons.add),
        backgroundColor: Colors.blue,
        foregroundColor: Colors.white,
      ),
    );
  }

  void _showOfferForm(BuildContext context) {
    showModalBottomSheet(
      context: context,
      isScrollControlled: true,
      backgroundColor: Colors.white,
      shape: RoundedRectangleBorder(
        borderRadius: BorderRadius.vertical(top: Radius.circular(20)),
      ),
      builder: (BuildContext context) {
        return SingleChildScrollView(
          child: Container(
            padding: EdgeInsets.only(
              bottom: MediaQuery.of(context).viewInsets.bottom,
            ),
            child: Padding(
              padding: const EdgeInsets.all(16.0),
              child: OfferForm(),
            ),
          ),
        );
      },
    );
  }
}


### File: lib/presentation/pages/login_page.dart

import 'package:flutter/material.dart';
import 'package:flutter_bloc/flutter_bloc.dart';
import '../bloc/authentication_bloc.dart';
import 'registration_page.dart';

class LoginPage extends StatelessWidget {
  final TextEditingController _emailController = TextEditingController();
  final TextEditingController _passwordController = TextEditingController();

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      resizeToAvoidBottomInset: false,
      body: BlocConsumer<AuthenticationBloc, AuthenticationState>(
        listener: (context, state) {
          if (state is AuthenticationError) {
            ScaffoldMessenger.of(context).showSnackBar(
              SnackBar(content: Text(state.message)),
            );
          } else if (state is Authenticated) {
            Navigator.of(context).pushReplacementNamed('/offers');
          }
        },
        builder: (context, state) {
          return Container(
            decoration: BoxDecoration(
              gradient: LinearGradient(
                begin: Alignment.topLeft,
                end: Alignment.bottomRight,
                colors: [Colors.blue.shade300, Colors.blue.shade700],
              ),
            ),
            child: SafeArea(
              child: Center(
                child: SingleChildScrollView(
                  padding: EdgeInsets.all(16.0),
                  child: ConstrainedBox(
                    constraints: BoxConstraints(maxWidth: 400),
                    child: Column(
                      mainAxisAlignment: MainAxisAlignment.center,
                      children: [
                        Image.asset('assets/logo.png', width: 120, height: 120),
                        SizedBox(height: 40),
                        Card(
                          
                          elevation: 8,
                          shape: RoundedRectangleBorder(
                            borderRadius: BorderRadius.circular(16),
                          ),
                          child: Padding(
                            padding: EdgeInsets.all(16),
                            child: Column(
                              children: [
                                SizedBox(height: 16),
                                TextFormField(
                                  controller: _emailController,
                                  decoration: InputDecoration(
                                    labelText: 'Email',
                                    prefixIcon: Icon(Icons.email),
                                    border: OutlineInputBorder(
                                      borderRadius: BorderRadius.circular(12),
                                    ),
                                  ),
                                  keyboardType: TextInputType.emailAddress,
                                ),
                                SizedBox(height: 16),
                                TextFormField(
                                  controller: _passwordController,
                                  decoration: InputDecoration(
                                    labelText: 'Password',
                                    prefixIcon: Icon(Icons.lock),
                                    border: OutlineInputBorder(
                                      borderRadius: BorderRadius.circular(12),
                                    ),
                                  ),
                                  obscureText: true,
                                ),
                                SizedBox(height: 24),
                                if (state is AuthenticationLoading)
                                  CircularProgressIndicator()
                                else
                                  ElevatedButton(
                                    child: Text('Login'),
                                    style: ElevatedButton.styleFrom(
                                      backgroundColor: Colors.blue,
                                      foregroundColor: Colors.white ,
                                      padding: EdgeInsets.symmetric(horizontal: 50, vertical: 15),
                                      shape: RoundedRectangleBorder(
                                        borderRadius: BorderRadius.circular(30),
                                      ),
                                    ),
                                    onPressed: () {
                                      if (_validateInputs(context)) {
                                        BlocProvider.of<AuthenticationBloc>(context).add(
                                          LoginEvent(_emailController.text, _passwordController.text),
                                        );
                                      }
                                    },
                                  ),
                              ],
                            ),
                          ),
                        ),
                        SizedBox(height: 16),
                        TextButton(
                          child: Text('Create an account', style: TextStyle(color: Colors.white)),
                          onPressed: () {
                            Navigator.push(
                              context,
                              MaterialPageRoute(builder: (context) => RegistrationPage()),
                            );
                          },
                        ),
                        SizedBox(height: 24),
                        Text('Or login with', style: TextStyle(color: Colors.white)),
                        SizedBox(height: 16),
                        Row(
                          mainAxisAlignment: MainAxisAlignment.center,
                          children: [
                            IconButton(
                              icon: Icon(Icons.facebook, color: Colors.white),
                              onPressed: () {
                                // Implement Facebook login
                              },
                            ),
                            IconButton(
                              icon: Icon(Icons.g_mobiledata, color: Colors.white),
                              onPressed: () {
                                // Implement Google login
                              },
                            ),
                          ],
                        ),
                      ],
                    ),
                  ),
                ),
              ),
            ),
          );
        },
      ),
    );
  }

  bool _validateInputs(BuildContext context) {
    if (_emailController.text.isEmpty || _passwordController.text.isEmpty) {
      ScaffoldMessenger.of(context).showSnackBar(
        SnackBar(content: Text('Please fill in all fields')),
      );
      return false;
    }
    return true;
  }
}

### File: lib/presentation/pages/home_page.dart

import 'package:flutter/material.dart';
import 'package:flutter_bloc/flutter_bloc.dart';
import '../bloc/authentication_bloc.dart';
import 'login_page.dart';
import 'offer_listing_page.dart';

class HomePage extends StatefulWidget {
  @override
  State<HomePage> createState() => _HomePageState();
}

class _HomePageState extends State<HomePage> {
  @override
  void initState() {
    // TODO: implement initState
    super.initState();
    context.read<AuthenticationBloc>().add(LoginWithTokenEvent());
  }
  @override
  Widget build(BuildContext context) {
    return BlocBuilder<AuthenticationBloc, AuthenticationState>(
      builder: (context, state) {
        if (state is AuthenticationLoading) {
          return Scaffold(body: Center(child: CircularProgressIndicator()));
        } else if (state is Authenticated) {
          return OfferListingPage();
        } else {
          return LoginPage();
        }
      },
    );
  }
}

### File: lib/presentation/pages/offer_details_page.dart

import 'package:firebase_auth/firebase_auth.dart';
import 'package:flutter/material.dart';
import 'package:flutter_bloc/flutter_bloc.dart';
import 'package:mobile_app/presentation/bloc/offer_event.dart';
import '../../domain/entities/offer.dart';
import '../bloc/offer_bloc.dart';
import '../bloc/purchase_bloc.dart';
import '../widgets/offer_form.dart';

class OfferDetailsPage extends StatelessWidget {
  final Offer offer;

  const OfferDetailsPage({Key? key, required this.offer}) : super(key: key);

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      body: CustomScrollView(
        slivers: <Widget>[
          SliverAppBar(
            foregroundColor: Colors.white,
            expandedHeight: 200.0,
            floating: false,
            pinned: true,
            flexibleSpace: FlexibleSpaceBar(
              title: Text(offer.title, style: TextStyle(
                fontSize: 16,
                fontWeight: FontWeight.bold,
                shadows: <Shadow>[
                  Shadow(
                    offset: Offset(1.0, 1.0),
                    blurRadius: 3.0,
                    color: Color.fromARGB(255, 0, 0, 0),
                  ),
                ],
                color: Colors.white
              ),),
              background: Image.asset(
                'assets/drawer_header_bg.jpg',
                fit: BoxFit.cover,
              ),
            ),
            actions: [
              IconButton(
                icon: Icon(Icons.edit),
                onPressed: () {
                  _showEditOfferForm(context);
                },
              ),
              IconButton(
                icon: Icon(Icons.delete),
                onPressed: () {
                  _showDeleteConfirmationDialog(context);
                },
              ),
            ],
            ),
          SliverToBoxAdapter(
            child: Padding(
              padding: const EdgeInsets.all(16.0),
              child: Column(
                crossAxisAlignment: CrossAxisAlignment.start,
                children: [
                  Container(
                    width: double.infinity,
                    child: Card(
                    
                      elevation: 4,
                      child: Padding(
                        padding: const EdgeInsets.all(16.0),
                        child: Column(
                          crossAxisAlignment: CrossAxisAlignment.start,
                          mainAxisSize: MainAxisSize.max,
                          children: [
                            Text(
                              'Description',
                              style: TextStyle(fontSize: 18, fontWeight: FontWeight.bold),
                            ),
                            SizedBox(height: 8),
                            Text(
                              offer.description,
                              style: TextStyle(fontSize: 16),
                            ),
                          ],
                        ),
                      ),
                    ),
                  ),
                  SizedBox(height: 16),
                  Card(
                    elevation: 4,
                    child: Padding(
                      padding: const EdgeInsets.all(16.0),
                      child: Column(
                        crossAxisAlignment: CrossAxisAlignment.start,
                        children: [
                          Text(
                            'Pricing Details',
                            style: TextStyle(fontSize: 18, fontWeight: FontWeight.bold),
                          ),
                          SizedBox(height: 8),
                          Row(
                            mainAxisAlignment: MainAxisAlignment.spaceBetween,
                            children: [
                              Text('Original Price:', style: TextStyle(fontSize: 16)),
                              Text('\$${offer.originalPrice.toStringAsFixed(2)}',
                                  style: TextStyle(fontSize: 16, decoration: TextDecoration.lineThrough)),
                            ],
                          ),
                          SizedBox(height: 4),
                          Row(
                            mainAxisAlignment: MainAxisAlignment.spaceBetween,
                            children: [
                              Text('Discounted Price:', style: TextStyle(fontSize: 16)),
                              Text('\$${offer.discountedPrice.toStringAsFixed(2)}',
                                  style: TextStyle(fontSize: 16, fontWeight: FontWeight.bold, color: Colors.green)),
                            ],
                          ),
                          SizedBox(height: 4),
                          Row(
                            mainAxisAlignment: MainAxisAlignment.spaceBetween,
                            children: [
                              Text('Discount:', style: TextStyle(fontSize: 16)),
                              Text('${offer.discountPercentage.toStringAsFixed(0)}%',
                                  style: TextStyle(fontSize: 16, fontWeight: FontWeight.bold, color: Colors.red)),
                            ],
                          ),
                        ],
                      ),
                    ),
                  ),
                  SizedBox(height: 24),
                  BlocConsumer<PurchaseBloc, PurchaseState>(
                    listener: (context, state) {
                      if (state is PurchaseSuccess) {
                        ScaffoldMessenger.of(context).showSnackBar(
                          SnackBar(
                            content: Text('Purchase successful!'),
                            backgroundColor: Colors.green,
                          ),
                        );
                      } else if (state is PurchaseFailure) {
                        ScaffoldMessenger.of(context).showSnackBar(
                          SnackBar(
                            content: Text('Purchase failed: ${state.message}'),
                            backgroundColor: Colors.red,
                          ),
                        );
                      }
                    },
                    builder: (context, state) {
                      if (state is PurchaseLoading) {
                        return Center(child: CircularProgressIndicator());
                      }
                      return Container(
                        padding: EdgeInsets.symmetric(horizontal: 48),
                        width: double.infinity,
                        child: ElevatedButton(
                          style: ElevatedButton.styleFrom(
                            backgroundColor: Colors.green,
                            foregroundColor: Colors.white,
                            padding: EdgeInsets.symmetric(vertical: 16, horizontal: 32),
                            shape: RoundedRectangleBorder(
                              borderRadius: BorderRadius.circular(8),
                            ),
                            
                          ),
                          child: Text('Buy Now', style: TextStyle(fontSize: 18)),
                          onPressed: () => _showBuyNowDialog(context),
                        ),
                      );
                    },
                  ),
                ],
              ),
            ),
          ),
        ],
      ),
    );
  }

  void _showEditOfferForm(BuildContext context) {
    showModalBottomSheet(
      context: context,
      isScrollControlled: true,
      shape: RoundedRectangleBorder(
        borderRadius: BorderRadius.vertical(top: Radius.circular(20)),
      ),
      builder: (BuildContext context) {
        return SingleChildScrollView(
          child: Container(
            padding: EdgeInsets.only(
              bottom: MediaQuery.of(context).viewInsets.bottom,
            ),
            child: Padding(
              padding: const EdgeInsets.all(16.0),
              child: OfferForm(offer: offer),
            ),
          ),
        );
      },
    );
  }

  void _showDeleteConfirmationDialog(BuildContext context) {
    showDialog(
      context: context,
      builder: (BuildContext context) {
        return AlertDialog(
          title: Text('Delete Offer'),
          content: Text('Are you sure you want to delete this offer?'),
          actions: <Widget>[
            TextButton(
              child: Text('Cancel'),
              onPressed: () => Navigator.of(context).pop(),
            ),
            TextButton(
              child: Text('Delete'),
              onPressed: () {
                BlocProvider.of<OfferBloc>(context).add(DeleteOfferEvent(offer.id));
                Navigator.of(context).pop(); // Close the dialog
                Navigator.of(context).pop(); // Go back to the listing page
              },
            ),
          ],
        );
      },
    );
  }

  void _showBuyNowDialog(BuildContext context) {
    showDialog(
      context: context,
      builder: (BuildContext context) {
        return AlertDialog(
          title: Text('Confirm Purchase'),
          content: Text('Are you sure you want to buy this offer?'),
          actions: <Widget>[
            TextButton(
              child: Text('Cancel'),
              onPressed: () => Navigator.of(context).pop(),
            ),
            TextButton(
              child: Text('Buy'),
              onPressed: () {
                Navigator.of(context).pop();
                String userId = FirebaseAuth.instance.currentUser!.uid;
                BlocProvider.of<PurchaseBloc>(context).add(PurchaseOfferEvent(offer, userId));
              },
            ),
          ],
        );
      },
    );
  }
}

### File: lib/presentation/pages/registration_page.dart

import 'package:flutter/material.dart';
import 'package:flutter_bloc/flutter_bloc.dart';
import '../bloc/authentication_bloc.dart';

class RegistrationPage extends StatelessWidget {
  final TextEditingController _emailController = TextEditingController();
  final TextEditingController _passwordController = TextEditingController();
  final TextEditingController _confirmPasswordController = TextEditingController();

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      resizeToAvoidBottomInset: false,
      body: BlocConsumer<AuthenticationBloc, AuthenticationState>(
        listener: (context, state) {
          if (state is AuthenticationError) {
            ScaffoldMessenger.of(context).showSnackBar(
              SnackBar(content: Text(state.message)),
            );
          } else if (state is Authenticated) {
            Navigator.of(context).pushReplacementNamed('/');
          }
        },
        builder: (context, state) {
          return Container(
            decoration: BoxDecoration(
              gradient: LinearGradient(
                begin: Alignment.topLeft,
                end: Alignment.bottomRight,
                colors: [Colors.blue.shade300, Colors.blue.shade700],
              ),
            ),
            child: SafeArea(
              child: Center(
                child: SingleChildScrollView(
                  padding: EdgeInsets.all(16.0),
                  child: ConstrainedBox(
                    constraints: BoxConstraints(maxWidth: 400),
                    child: Column(
                      mainAxisAlignment: MainAxisAlignment.center,
                      children: [
                        Text(
                          'Create Account',
                          style: TextStyle(
                            fontSize: 32,
                            fontWeight: FontWeight.bold,
                            color: Colors.white,
                          ),
                        ),
                        SizedBox(height: 40),
                        Card(
                          elevation: 8,
                          shape: RoundedRectangleBorder(
                            borderRadius: BorderRadius.circular(16),
                          ),
                          child: Padding(
                            padding: EdgeInsets.all(16),
                            child: Column(
                              children: [
                                SizedBox(height: 16),
                                TextFormField(
                                  controller: _emailController,
                                  decoration: InputDecoration(
                                    labelText: 'Email',
                                    prefixIcon: Icon(Icons.email),
                                    border: OutlineInputBorder(
                                      borderRadius: BorderRadius.circular(12),
                                    ),
                                  ),
                                  keyboardType: TextInputType.emailAddress,
                                ),
                                SizedBox(height: 16),
                                TextFormField(
                                  controller: _passwordController,
                                  decoration: InputDecoration(
                                    labelText: 'Password',
                                    prefixIcon: Icon(Icons.lock),
                                    border: OutlineInputBorder(
                                      borderRadius: BorderRadius.circular(12),
                                    ),
                                  ),
                                  obscureText: true,
                                ),
                                SizedBox(height: 16),
                                TextFormField(
                                  controller: _confirmPasswordController,
                                  decoration: InputDecoration(
                                    labelText: 'Confirm Password',
                                    prefixIcon: Icon(Icons.lock_outline),
                                    border: OutlineInputBorder(
                                      borderRadius: BorderRadius.circular(12),
                                    ),
                                  ),
                                  obscureText: true,
                                ),
                                SizedBox(height: 24),
                                if (state is AuthenticationLoading)
                                  CircularProgressIndicator()
                                else
                                  ElevatedButton(
                                    child: Text('Register'),
                                    style: ElevatedButton.styleFrom(
                                      backgroundColor: Colors.blue,
                                      foregroundColor: Colors.white ,
                                      padding: EdgeInsets.symmetric(horizontal: 50, vertical: 15),
                                      shape: RoundedRectangleBorder(
                                        borderRadius: BorderRadius.circular(30),
                                      ),
                                    ),
                                    onPressed: () {
                                      if (_validateInputs(context)) {
                                        BlocProvider.of<AuthenticationBloc>(context).add(
                                          RegisterEvent(_emailController.text, _passwordController.text),
                                        );
                                      }
                                    },
                                  ),
                              ],
                            ),
                          ),
                        ),
                        SizedBox(height: 16),
                        TextButton(
                          child: Text('Already have an account? Login', style: TextStyle(color: Colors.white)),
                          onPressed: () {
                            Navigator.of(context).pop();
                          },
                        ),
                      ],
                    ),
                  ),
                ),
              ),
            ),
          );
        },
      ),
    );
  }

  bool _validateInputs(BuildContext context) {
    if (_emailController.text.isEmpty || 
        _passwordController.text.isEmpty || 
        _confirmPasswordController.text.isEmpty) {
      ScaffoldMessenger.of(context).showSnackBar(
        SnackBar(content: Text('Please fill in all fields')),
      );
      return false;
    }
    if (_passwordController.text != _confirmPasswordController.text) {
      ScaffoldMessenger.of(context).showSnackBar(
        SnackBar(content: Text('Passwords do not match')),
      );
      return false;
    }
    return true;
  }
}

### File: lib/presentation/widgets/app_drawer.dart

import 'package:flutter/material.dart';
import '../pages/offer_listing_page.dart';
import '../pages/purchase_history_page.dart';
import '../../core/services/auth_service.dart';

class AppDrawer extends StatelessWidget {
  final AuthService authService;

  const AppDrawer({Key? key, required this.authService}) : super(key: key);

  @override
  Widget build(BuildContext context) {
    return Drawer(
      child: Column(
        children: <Widget>[
          _buildDrawerHeader(context),
          Expanded(
            child: ListView(
              padding: EdgeInsets.zero,
              children: <Widget>[
                _buildDrawerItem(
                  icon: Icons.local_offer,
                  title: 'Offers',
                  onTap: () => _navigateTo(context, OfferListingPage()),
                ),
                _buildDrawerItem(
                  icon: Icons.history,
                  title: 'Purchase History',
                  onTap: () => _navigateTo(context, PurchaseHistoryPage(userId: authService.currentUser!.uid)),
                ),
                Divider(),
                _buildDrawerItem(
                  icon: Icons.settings,
                  title: 'Settings',
                  onTap: () {
                    // Navigate to settings page
                  },
                ),
                _buildDrawerItem(
                  icon: Icons.help,
                  title: 'Help & Feedback',
                  onTap: () {
                    // Navigate to help page
                  },
                ),
              ],
            ),
          ),
          _buildLogoutButton(context),
        ],
      ),
    );
  }

  Widget _buildDrawerHeader(BuildContext context) {
    return UserAccountsDrawerHeader(
      decoration: BoxDecoration(
        color: Theme.of(context).primaryColor,
        image: DecorationImage(
          fit: BoxFit.cover,
          image: AssetImage('assets/drawer_header_bg.jpg'), // Add a background image
          colorFilter: ColorFilter.mode(
            Colors.black.withOpacity(0.5),
            BlendMode.darken,
          ),
        ),
      ),
      currentAccountPicture: CircleAvatar(
        child: Icon(Icons.person, size: 48),
        // backgroundImage: AssetImage('assets/default_avatar.png'), // Add a default avatar image
      ),
      accountName: Text(
        authService.currentUser?.displayName ?? 'User',
        style: TextStyle(
          fontWeight: FontWeight.bold,
          fontSize: 18,
        ),
      ),
      accountEmail: Text(
        authService.currentUser?.email ?? '',
        style: TextStyle(
          fontSize: 14,
        ),
      ),
    );
  }

  Widget _buildDrawerItem({required IconData icon, required String title, required VoidCallback onTap}) {
    return ListTile(
      leading: Icon(icon, color: Colors.blue),
      title: Text(
        title,
        style: TextStyle(fontSize: 16),
      ),
      onTap: onTap,
    );
  }

  Widget _buildLogoutButton(BuildContext context) {
    return Container(
      padding: EdgeInsets.symmetric(vertical: 10, horizontal: 16),
      child: ElevatedButton(
        style: ElevatedButton.styleFrom(
          backgroundColor: Colors.red,
          foregroundColor: Colors.white,
          shape: RoundedRectangleBorder(
            borderRadius: BorderRadius.circular(30),
          ),
        ),
        child: Row(
          mainAxisAlignment: MainAxisAlignment.center,
          children: [
            Icon(Icons.exit_to_app),
            SizedBox(width: 8),
            Text('Logout'),
          ],
        ),
        onPressed: () async {
          await authService.signOut();
          Navigator.pushReplacementNamed(context, '/login');
        },
      ),
    );
  }

  void _navigateTo(BuildContext context, Widget page) {
    Navigator.pop(context); // Close the drawer
    Navigator.push(context, MaterialPageRoute(builder: (context) => page));
  }
}

### File: lib/presentation/widgets/offer_form.dart

import 'package:flutter/material.dart';
import 'package:flutter/services.dart';
import 'package:flutter_bloc/flutter_bloc.dart';
import 'package:mobile_app/presentation/bloc/offer_event.dart';
import '../../domain/entities/offer.dart';
import '../bloc/offer_bloc.dart';

class OfferForm extends StatefulWidget {
  final Offer? offer;

  const OfferForm({Key? key, this.offer}) : super(key: key);

  @override
  _OfferFormState createState() => _OfferFormState();
}

class _OfferFormState extends State<OfferForm> {
  final _formKey = GlobalKey<FormState>();
  late TextEditingController _titleController;
  late TextEditingController _descriptionController;
  late TextEditingController _discountPercentageController;
  late TextEditingController _originalPriceController;
  late TextEditingController _discountedPriceController;

  @override
  void initState() {
    super.initState();
    _titleController = TextEditingController(text: widget.offer?.title ?? '');
    _descriptionController = TextEditingController(text: widget.offer?.description ?? '');
    _discountPercentageController = TextEditingController(text: widget.offer?.discountPercentage.toString() ?? '');
    _originalPriceController = TextEditingController(text: widget.offer?.originalPrice.toString() ?? '');
    _discountedPriceController = TextEditingController(text: widget.offer?.discountedPrice.toString() ?? '');
  }

  @override
  Widget build(BuildContext context) {
    return Form(
    
      key: _formKey,
      child: Column(
        crossAxisAlignment: CrossAxisAlignment.stretch,
        children: [
          Text(
            widget.offer == null ? 'Create New Offer' : 'Edit Offer',
            style: TextStyle(fontSize: 24, fontWeight: FontWeight.bold),
            textAlign: TextAlign.center,
          ),
          SizedBox(height: 20),
          _buildTextField(
            controller: _titleController,
            label: 'Title',
            icon: Icons.title,
            validator: (value) {
              if (value == null || value.isEmpty) {
                return 'Please enter a title';
              }
              return null;
            },
          ),
          SizedBox(height: 16),
          _buildTextField(
            controller: _descriptionController,
            label: 'Description',
            icon: Icons.description,
            maxLines: 3,
            validator: (value) {
              if (value == null || value.isEmpty) {
                return 'Please enter a description';
              }
              return null;
            },
          ),
          SizedBox(height: 16),
          _buildTextField(
            controller: _discountPercentageController,
            label: 'Discount Percentage',
            icon: Icons.percent,
            keyboardType: TextInputType.number,
            inputFormatters: [FilteringTextInputFormatter.digitsOnly],
            validator: (value) {
              if (value == null || value.isEmpty) {
                return 'Please enter a discount percentage';
              }
              final percentage = int.tryParse(value);
              if (percentage == null || percentage < 0 || percentage > 100) {
                return 'Please enter a valid percentage between 0 and 100';
              }
              return null;
            },
          ),
          SizedBox(height: 16),
          _buildTextField(
            controller: _originalPriceController,
            label: 'Original Price',
            icon: Icons.attach_money,
            keyboardType: TextInputType.numberWithOptions(decimal: true),
            inputFormatters: [FilteringTextInputFormatter.allow(RegExp(r'^\d+\.?\d{0,2}'))],
            validator: (value) {
              if (value == null || value.isEmpty) {
                return 'Please enter an original price';
              }
              final price = double.tryParse(value);
              if (price == null || price <= 0) {
                return 'Please enter a valid price greater than 0';
              }
              return null;
            },
          ),
          SizedBox(height: 16),
          _buildTextField(
            controller: _discountedPriceController,
            label: 'Discounted Price',
            icon: Icons.local_offer,
            keyboardType: TextInputType.numberWithOptions(decimal: true),
            inputFormatters: [FilteringTextInputFormatter.allow(RegExp(r'^\d+\.?\d{0,2}'))],
            validator: (value) {
              if (value == null || value.isEmpty) {
                return 'Please enter a discounted price';
              }
              final discountedPrice = double.tryParse(value);
              final originalPrice = double.tryParse(_originalPriceController.text);
              if (discountedPrice == null || discountedPrice <= 0 || originalPrice == null || discountedPrice >= originalPrice) {
                return 'Please enter a valid discounted price (greater than 0 and less than the original price)';
              }
              return null;
            },
          ),
          SizedBox(height: 24),
          ElevatedButton(
            onPressed: _submitForm,
            child: Text(widget.offer == null ? 'Create Offer' : 'Update Offer'),
            style: ElevatedButton.styleFrom(
              backgroundColor: Colors.blue,
              foregroundColor: Colors.white,
              padding: EdgeInsets.symmetric(vertical: 16),
              textStyle: TextStyle(fontSize: 18, fontWeight: FontWeight.bold),
              shape: RoundedRectangleBorder(
                borderRadius: BorderRadius.circular(8),
              ),
            ),
          ),
        ],
      ),
    );
  }

  Widget _buildTextField({
    required TextEditingController controller,
    required String label,
    required IconData icon,
    int maxLines = 1,
    TextInputType? keyboardType,
    List<TextInputFormatter>? inputFormatters,
    String? Function(String?)? validator,
  }) {
    return TextFormField(
      controller: controller,
      decoration: InputDecoration(
        labelText: label,
        prefixIcon: Icon(icon),
        border: OutlineInputBorder(
          borderRadius: BorderRadius.circular(8),
        ),
        filled: true,
        fillColor: Colors.grey[200],
      ),
      maxLines: maxLines,
      keyboardType: keyboardType,
      inputFormatters: inputFormatters,
      validator: validator,
    );
  }

  void _submitForm() {
    if (_formKey.currentState!.validate()) {
      final offer = Offer(
        id: widget.offer?.id ?? '',
        title: _titleController.text,
        description: _descriptionController.text,
        discountPercentage: double.parse(_discountPercentageController.text),
        originalPrice: double.parse(_originalPriceController.text),
        discountedPrice: double.parse(_discountedPriceController.text),
      );

      if (widget.offer == null) {
        BlocProvider.of<OfferBloc>(context).add(CreateOfferEvent(offer));
      } else {
        BlocProvider.of<OfferBloc>(context).add(UpdateOfferEvent(offer));
      }

      Navigator.pop(context);
    }
  }

  @override
  void dispose() {
    _titleController.dispose();
    _descriptionController.dispose();
    _discountPercentageController.dispose();
    _originalPriceController.dispose();
    _discountedPriceController.dispose();
    super.dispose();
  }
}

### File: lib/presentation/widgets/offer_card.dart

import 'package:flutter/material.dart';
import '../../domain/entities/offer.dart';

class OfferCard extends StatelessWidget {
  final Offer offer;
  final VoidCallback onTap;

  const OfferCard({Key? key, required this.offer, required this.onTap}) : super(key: key);

  @override
  Widget build(BuildContext context) {
    return Card(
      elevation: 2,
      shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(12)),
      child: InkWell(
        onTap: onTap,
        child: Padding(
          padding: EdgeInsets.all(12),
          child: Column(
            crossAxisAlignment: CrossAxisAlignment.start,
            mainAxisSize: MainAxisSize.min,
            children: [
              Text(
                offer.title,
                style: TextStyle(fontSize: 16, fontWeight: FontWeight.bold),
                maxLines: 2,
                overflow: TextOverflow.ellipsis,
              ),
              SizedBox(height: 4),
              Text(
                offer.description,
                style: TextStyle(fontSize: 12, color: Colors.grey[600]),
                maxLines: 2,
                overflow: TextOverflow.ellipsis,
              ),
              SizedBox(height: 8),
              Row(
                mainAxisAlignment: MainAxisAlignment.spaceBetween,
                children: [
                  Column(
                    crossAxisAlignment: CrossAxisAlignment.start,
                    children: [
                      Text(
                        '\$${offer.discountedPrice.toStringAsFixed(2)}',
                        style: TextStyle(
                          fontSize: 16,
                          fontWeight: FontWeight.bold,
                          color: Theme.of(context).primaryColor,
                        ),
                      ),
                      Text(
                        '\$${offer.originalPrice.toStringAsFixed(2)}',
                        style: TextStyle(
                          fontSize: 12,
                          decoration: TextDecoration.lineThrough,
                          color: Colors.grey,
                        ),
                      ),
                    ],
                  ),
                  Container(
                    padding: EdgeInsets.symmetric(horizontal: 6, vertical: 2),
                    decoration: BoxDecoration(
                      color: Theme.of(context).primaryColor,
                      borderRadius: BorderRadius.circular(8),
                    ),
                    child: Text(
                      '${offer.discountPercentage.toStringAsFixed(0)}% OFF',
                      style: TextStyle(color: Colors.white, fontSize: 12, fontWeight: FontWeight.bold),
                    ),
                  ),
                ],
              ),
            ],
          ),
        ),
      ),
    );
  }
}

### File: lib/presentation/bloc/offer_bloc.dart

import 'package:flutter_bloc/flutter_bloc.dart';
import 'package:mobile_app/core/usecases/usecase.dart';
import '../../domain/usecases/get_offers.dart';
import '../../domain/usecases/create_offer.dart';
import '../../domain/usecases/update_offer.dart';
import '../../domain/usecases/delete_offer.dart';
import '../../core/error/failures.dart';
import 'offer_event.dart';
import 'offer_state.dart';

class OfferBloc extends Bloc<OfferEvent, OfferState> {
  final GetOffers getOffers;
  final CreateOffer createOffer;
  final UpdateOffer updateOffer;
  final DeleteOffer deleteOffer;

  OfferBloc({
    required this.getOffers,
    required this.createOffer,
    required this.updateOffer,
    required this.deleteOffer,
  }) : super(OfferInitial()) {
    on<GetOffersEvent>(_onGetOffers);
    on<CreateOfferEvent>(_onCreateOffer);
    on<UpdateOfferEvent>(_onUpdateOffer);
    on<DeleteOfferEvent>(_onDeleteOffer);
  }

  void _onGetOffers(GetOffersEvent event, Emitter<OfferState> emit) async {
    emit(OfferLoading());
    try {
      final failureOrOffers = await getOffers(NoParams());
      emit(failureOrOffers.fold(
        (failure) => OfferError(_mapFailureToMessage(failure)),
        (offers) => OfferLoaded(offers),
      ));
    } catch (e) {
      emit(OfferError('An unexpected error occurred: ${e.toString()}'));
    }
  }

  void _onCreateOffer(CreateOfferEvent event, Emitter<OfferState> emit) async {
    emit(OfferLoading());
    try {
      final failureOrOffer = await createOffer(CreateOfferParams(event.offer));

      emit(failureOrOffer.fold(
        (failure) => OfferError(_mapFailureToMessage(failure)),
        (offer) {
          add(GetOffersEvent());
          return OfferCreated(offer);},
      ));
    } catch (e) {
      emit(OfferError('An unexpected error occurred: ${e.toString()}'));
    }
  }

  void _onUpdateOffer(UpdateOfferEvent event, Emitter<OfferState> emit) async {
    emit(OfferLoading());
    try {
      final failureOrOffer = await updateOffer(UpdateOfferParams(event.offer));
      emit(failureOrOffer.fold(
        (failure) => OfferError(_mapFailureToMessage(failure)),
        (offer) {
          add(GetOffersEvent());
          return OfferUpdated(offer);},
      ));
    } catch (e) {
      emit(OfferError('An unexpected error occurred: ${e.toString()}'));
    }
  }

  void _onDeleteOffer(DeleteOfferEvent event, Emitter<OfferState> emit) async {
    emit(OfferLoading());
    try {
      final failureOrVoid = await deleteOffer(event.offerId);
      emit(failureOrVoid.fold(
        (failure) => OfferError(_mapFailureToMessage(failure)),
        (_) => OfferDeleted(),
      ));
    } catch (e) {
      emit(OfferError('An unexpected error occurred: ${e.toString()}'));
    }
  }

  String _mapFailureToMessage(Failure failure) {
    switch (failure.runtimeType) {
      case ServerFailure:
        return 'Server failure. Please try again later.';
      case NetworkFailure:
        return 'Network failure. Please check your internet connection.';
      case ValidationFailure:
        return (failure as ValidationFailure).message;
      default:
        return 'Unexpected error. Please try again.';
    }
  }
}

### File: lib/presentation/bloc/purchase_bloc.dart

import 'package:flutter_bloc/flutter_bloc.dart';
import 'package:equatable/equatable.dart';
import '../../domain/usecases/purchase_offer.dart';
import '../../domain/entities/offer.dart';
import '../../core/error/failures.dart';

// Events
abstract class PurchaseEvent extends Equatable {
  const PurchaseEvent();

  @override
  List<Object> get props => [];
}

class PurchaseOfferEvent extends PurchaseEvent {
  final Offer offer;
  final String userId;

  const PurchaseOfferEvent(this.offer, this.userId);

  @override
  List<Object> get props => [offer, userId];
}

// States
abstract class PurchaseState extends Equatable {
  const PurchaseState();
  
  @override
  List<Object> get props => [];
}

class PurchaseInitial extends PurchaseState {}

class PurchaseLoading extends PurchaseState {}

class PurchaseSuccess extends PurchaseState {}

class PurchaseFailure extends PurchaseState {
  final String message;

  const PurchaseFailure(this.message);

  @override
  List<Object> get props => [message];
}

// BLoC
class PurchaseBloc extends Bloc<PurchaseEvent, PurchaseState> {
  final PurchaseOffer purchaseOffer;

  PurchaseBloc({required this.purchaseOffer}) : super(PurchaseInitial()) {
    on<PurchaseOfferEvent>(_onPurchaseOffer);
  }

  void _onPurchaseOffer(PurchaseOfferEvent event, Emitter<PurchaseState> emit) async {
    emit(PurchaseLoading());
    final result = await purchaseOffer(PurchaseOfferParams(event.offer, event.userId));
    emit(result.fold(
      (failure) => PurchaseFailure(_mapFailureToMessage(failure)),
      (_) => PurchaseSuccess(),
    ));
  }

  String _mapFailureToMessage(Failure failure) {
    switch (failure.runtimeType) {
      case ServerFailure:
        return 'Couldn\'t connect to the server. Please try again.';
      case NetworkFailure:
        return 'No internet connection. Please check your network settings.';
      case PurchaseFailure:
        return 'Failed to complete the purchase. Please try again.';
      default:
        return 'An unexpected error occurred. Please try again.';
    }
  }
}

### File: lib/presentation/bloc/offer_state.dart

import 'package:equatable/equatable.dart';
import '../../domain/entities/offer.dart';

abstract class OfferState extends Equatable {
  const OfferState();
  
  @override
  List<Object> get props => [];
}

class OfferInitial extends OfferState {}

class OfferLoading extends OfferState {}

class OfferLoaded extends OfferState {
  final List<Offer> offers;

  const OfferLoaded(this.offers);

  @override
  List<Object> get props => [offers];
}

class OfferError extends OfferState {
  final String message;

  const OfferError(this.message);

  @override
  List<Object> get props => [message];
}

class OfferCreated extends OfferState {
  final Offer offer;

  const OfferCreated(this.offer);

  @override
  List<Object> get props => [offer];
}

class OfferUpdated extends OfferState {
  final Offer offer;

  const OfferUpdated(this.offer);

  @override
  List<Object> get props => [offer];
}

class OfferDeleted extends OfferState {}

### File: lib/presentation/bloc/authentication_bloc.dart

import 'dart:math';

import 'package:flutter_bloc/flutter_bloc.dart';
import 'package:equatable/equatable.dart';
import '../../core/services/auth_service.dart';

// Events
abstract class AuthenticationEvent extends Equatable {
  const AuthenticationEvent();

  @override
  List<Object> get props => [];
}

class LoginEvent extends AuthenticationEvent {
  final String email;
  final String password;

  const LoginEvent(this.email, this.password);

  @override
  List<Object> get props => [email, password];
}

class LoginWithTokenEvent extends AuthenticationEvent {}

class RegisterEvent extends AuthenticationEvent {
  final String email;
  final String password;

  const RegisterEvent(this.email, this.password);

  @override
  List<Object> get props => [email, password];
}

class LogoutEvent extends AuthenticationEvent {}

// States
abstract class AuthenticationState extends Equatable {
  const AuthenticationState();

  @override
  List<Object> get props => [];
}

class AuthenticationInitial extends AuthenticationState {}

class AuthenticationLoading extends AuthenticationState {}

class Authenticated extends AuthenticationState {}

class Unauthenticated extends AuthenticationState {}

class AuthenticationError extends AuthenticationState {
  final String message;

  const AuthenticationError(this.message);

  @override
  List<Object> get props => [message];
}

// BLoC
class AuthenticationBloc extends Bloc<AuthenticationEvent, AuthenticationState> {
  final AuthService authService;

  AuthenticationBloc({required this.authService}) : super(AuthenticationInitial()) {
    on<LoginEvent>(_onLogin);
    on<LoginWithTokenEvent>(_onLoginWithToken);
    on<RegisterEvent>(_onRegister);
    on<LogoutEvent>(_onLogout);
  }


  void _onLogin(LoginEvent event, Emitter<AuthenticationState> emit) async {
    emit(AuthenticationLoading());
    try {
      await authService.signIn(event.email, event.password);
      
      emit(Authenticated());
    } catch (e) {
      emit(AuthenticationError(e.toString()));
    }
  }

  void _onLoginWithToken(LoginWithTokenEvent event, Emitter<AuthenticationState> emit) async {
    emit(AuthenticationLoading());
    try {
      final isAuthenticated = await authService.checkAndSignInWithToken();
      if (isAuthenticated) {
        emit(Authenticated());
      } else {
        emit(Unauthenticated());
      }
    } catch (e) {
      emit(AuthenticationError(e.toString()));
    }
  }

  void _onRegister(RegisterEvent event, Emitter<AuthenticationState> emit) async {
    emit(AuthenticationLoading());
    try {
      await authService.signUp(event.email, event.password);
      emit(Authenticated());
    } catch (e) {
      emit(AuthenticationError(e.toString()));
    }
  }

  void _onLogout(LogoutEvent event, Emitter<AuthenticationState> emit) async {
    emit(AuthenticationLoading());
    try {
      await authService.signOut();
      emit(Unauthenticated());
    } catch (e) {
      emit(AuthenticationError(e.toString()));
    }
  }
}

### File: lib/presentation/bloc/purchase_history_bloc.dart

import 'package:flutter_bloc/flutter_bloc.dart';
import 'package:equatable/equatable.dart';
import 'package:mobile_app/core/error/failures.dart';
import '../../domain/entities/purchase_history.dart';
import '../../domain/usecases/get_purchase_history.dart';

// Events
abstract class PurchaseHistoryEvent extends Equatable {
  const PurchaseHistoryEvent();

  @override
  List<Object> get props => [];
}

class GetPurchaseHistoryEvent extends PurchaseHistoryEvent {
  final String userId;

  const GetPurchaseHistoryEvent(this.userId);

  @override
  List<Object> get props => [userId];
}

// States
abstract class PurchaseHistoryState extends Equatable {
  const PurchaseHistoryState();
  
  @override
  List<Object> get props => [];
}

class PurchaseHistoryInitial extends PurchaseHistoryState {}

class PurchaseHistoryLoading extends PurchaseHistoryState {}

class PurchaseHistoryLoaded extends PurchaseHistoryState {
  final List<PurchaseHistory> purchaseHistory;

  const PurchaseHistoryLoaded(this.purchaseHistory);

  @override
  List<Object> get props => [purchaseHistory];
}

class PurchaseHistoryError extends PurchaseHistoryState {
  final String message;

  const PurchaseHistoryError(this.message);

  @override
  List<Object> get props => [message];
}

// BLoC
class PurchaseHistoryBloc extends Bloc<PurchaseHistoryEvent, PurchaseHistoryState> {
  final GetPurchaseHistory getPurchaseHistory;

  PurchaseHistoryBloc({required this.getPurchaseHistory}) : super(PurchaseHistoryInitial()) {
    on<GetPurchaseHistoryEvent>(_onGetPurchaseHistory);
  }

  void _onGetPurchaseHistory(GetPurchaseHistoryEvent event, Emitter<PurchaseHistoryState> emit) async {
    emit(PurchaseHistoryLoading());
    final result = await getPurchaseHistory(event.userId);
    emit(result.fold(
      (failure) => PurchaseHistoryError(_mapFailureToMessage(failure)),
      (purchaseHistory) => PurchaseHistoryLoaded(purchaseHistory),
    ));
  }

  String _mapFailureToMessage(Failure failure) {
    switch (failure.runtimeType) {
      case ServerFailure:
        return 'Couldn\'t connect to the server. Please try again.';
      case NetworkFailure:
        return 'No internet connection. Please check your network settings.';
      default:
        return 'An unexpected error occurred. Please try again.';
    }
  }
}

### File: lib/presentation/bloc/offer_event.dart

import 'package:equatable/equatable.dart';
import '../../domain/entities/offer.dart';

abstract class OfferEvent extends Equatable {
  const OfferEvent();

  @override
  List<Object> get props => [];
}

class GetOffersEvent extends OfferEvent {}

class CreateOfferEvent extends OfferEvent {
  final Offer offer;

  const CreateOfferEvent(this.offer);

  @override
  List<Object> get props => [offer];
}

class UpdateOfferEvent extends OfferEvent {
  final Offer offer;

  const UpdateOfferEvent(this.offer);

  @override
  List<Object> get props => [offer];
}

class DeleteOfferEvent extends OfferEvent {
  final String offerId;

  const DeleteOfferEvent(this.offerId);

  @override
  List<Object> get props => [offerId];
}

### File: test/domain/usecases/get_offers_test.dart

import 'package:dartz/dartz.dart';
import 'package:flutter_test/flutter_test.dart';
import 'package:mobile_app/core/usecases/usecase.dart';
import 'package:mobile_app/domain/entities/offer.dart';
import 'package:mobile_app/domain/repositories/offer_repository.dart';
import 'package:mobile_app/domain/usecases/get_offers.dart';
import 'package:mockito/mockito.dart';

class MockOfferRepository extends Mock implements OfferRepository {}

void main() {
  late GetOffers usecase;
  late MockOfferRepository mockOfferRepository;

  setUp(() {
    mockOfferRepository = MockOfferRepository();
    usecase = GetOffers(mockOfferRepository);
  });

  final tOffers = [
    Offer(id: '1', title: 'Test Offer', description: 'Test Description', discountPercentage: 10, originalPrice: 100, discountedPrice: 90),
  ];

  test(
    'should get offers from the repository',
    () async {
      // arrange
      when(mockOfferRepository.getOffers())
          .thenAnswer((_) async => Right(tOffers));
      // act
      final result = await usecase(NoParams());
      // assert
      expect(result, Right(tOffers));
      verify(mockOfferRepository.getOffers());
      verifyNoMoreInteractions(mockOfferRepository);
    },
  );
}

### File: test/domain/usecases/create_offer_test.dart

import 'package:flutter_test/flutter_test.dart';
import 'package:mobile_app/core/error/failures.dart';
import 'package:mobile_app/domain/entities/offer.dart';
import 'package:mobile_app/domain/repositories/offer_repository.dart';
import 'package:mobile_app/domain/usecases/create_offer.dart';
import 'package:mockito/mockito.dart';
import 'package:dartz/dartz.dart';

class MockOfferRepository extends Mock implements OfferRepository {}

void main() {
  late CreateOffer usecase;
  late MockOfferRepository mockOfferRepository;

  setUp(() {
    mockOfferRepository = MockOfferRepository();
    usecase = CreateOffer(mockOfferRepository);
  });

  final tOffer = Offer(
    id: '1',
    title: 'Test Offer',
    description: 'Test Description',
    discountPercentage: 10,
    originalPrice: 100,
    discountedPrice: 90,
  );

  test(
    'should create the offer when the input is valid',
    () async {
      // arrange
      when(mockOfferRepository.createOffer(any))
          .thenAnswer((_) async => Right(tOffer));
      // act
      final result = await usecase(CreateOfferParams(tOffer));
      // assert
      expect(result, Right(tOffer));
      verify(mockOfferRepository.createOffer(tOffer));
      verifyNoMoreInteractions(mockOfferRepository);
    },
  );

  test(
    'should return a ValidationFailure when the title is empty',
    () async {
      // arrange
      final invalidOffer = tOffer.copyWith(title: '');
      // act
      final result = await usecase(CreateOfferParams(invalidOffer));
      // assert
      expect(result, Left(ValidationFailure('Title cannot be empty')));
      verifyZeroInteractions(mockOfferRepository);
    },
  );

  // Add more tests for other validation cases
}

### File: test/domain/usecases/delete_offer_test.dart

import 'package:dartz/dartz.dart';
import 'package:flutter_test/flutter_test.dart';
import 'package:mobile_app/core/error/failures.dart';
import 'package:mobile_app/domain/repositories/offer_repository.dart';
import 'package:mobile_app/domain/usecases/delete_offer.dart';
import 'package:mockito/mockito.dart';

class MockOfferRepository extends Mock implements OfferRepository {}

void main() {
  late DeleteOffer usecase;
  late MockOfferRepository mockOfferRepository;

  setUp(() {
    mockOfferRepository = MockOfferRepository();
    usecase = DeleteOffer(mockOfferRepository);
  });

  final tOfferId = '1';

  test(
    'should delete the offer when the id is valid',
    () async {
      // arrange
      when(mockOfferRepository.deleteOffer(any))
          .thenAnswer((_) async => Right(null));
      // act
      final result = await usecase(tOfferId);
      // assert
      expect(result, Right(null));
      verify(mockOfferRepository.deleteOffer(tOfferId));
      verifyNoMoreInteractions(mockOfferRepository);
    },
  );

  test(
    'should return a Failure when the repository call fails',
    () async {
      // arrange
      when(mockOfferRepository.deleteOffer(any))
          .thenAnswer((_) async => Left(ServerFailure()));
      // act
      final result = await usecase(tOfferId);
      // assert
      expect(result, Left(ServerFailure()));
      verify(mockOfferRepository.deleteOffer(tOfferId));
      verifyNoMoreInteractions(mockOfferRepository);
    },
  );
}

### File: test/domain/usecases/update_offer_test.dart

import 'package:dartz/dartz.dart';
import 'package:flutter_test/flutter_test.dart';
import 'package:mobile_app/core/error/failures.dart';
import 'package:mobile_app/domain/entities/offer.dart';
import 'package:mobile_app/domain/repositories/offer_repository.dart';
import 'package:mobile_app/domain/usecases/update_offer.dart';
import 'package:mockito/mockito.dart';

class MockOfferRepository extends Mock implements OfferRepository {}

void main() {
  late UpdateOffer usecase;
  late MockOfferRepository mockOfferRepository;

  setUp(() {
    mockOfferRepository = MockOfferRepository();
    usecase = UpdateOffer(mockOfferRepository);
  });

  final tOffer = Offer(
    id: '1',
    title: 'Test Offer',
    description: 'Test Description',
    discountPercentage: 10,
    originalPrice: 100,
    discountedPrice: 90,
  );

  test(
    'should update the offer when the input is valid',
    () async {
      // arrange
      when(mockOfferRepository.updateOffer(any))
          .thenAnswer((_) async => Right(tOffer));
      // act
      final result = await usecase(UpdateOfferParams(tOffer));
      // assert
      expect(result, Right(tOffer));
      verify(mockOfferRepository.updateOffer(tOffer));
      verifyNoMoreInteractions(mockOfferRepository);
    },
  );

  test(
    'should return a ValidationFailure when the title is empty',
    () async {
      // arrange
      final invalidOffer = tOffer.copyWith(title: '');
      // act
      final result = await usecase(UpdateOfferParams(invalidOffer));
      // assert
      expect(result, Left(ValidationFailure('Title cannot be empty')));
      verifyZeroInteractions(mockOfferRepository);
    },
  );

  // Add more tests for other validation cases
}

### File: test/presentation/bloc/offer_bloc_test.dart

import 'package:flutter_test/flutter_test.dart';
import 'package:mobile_app/core/error/failures.dart';
import 'package:mobile_app/domain/entities/offer.dart';
import 'package:mobile_app/domain/usecases/create_offer.dart';
import 'package:mobile_app/domain/usecases/delete_offer.dart';
import 'package:mobile_app/domain/usecases/get_offers.dart';
import 'package:mobile_app/domain/usecases/update_offer.dart';
import 'package:mobile_app/presentation/bloc/offer_bloc.dart';
import 'package:mobile_app/presentation/bloc/offer_event.dart';
import 'package:mobile_app/presentation/bloc/offer_state.dart';
import 'package:mockito/mockito.dart';
import 'package:bloc_test/bloc_test.dart';
import 'package:dartz/dartz.dart';

class MockGetOffers extends Mock implements GetOffers {}
class MockCreateOffer extends Mock implements CreateOffer {}
class MockUpdateOffer extends Mock implements UpdateOffer {}
class MockDeleteOffer extends Mock implements DeleteOffer {}

void main() {
  late OfferBloc bloc;
  late MockGetOffers mockGetOffers;
  late MockCreateOffer mockCreateOffer;
  late MockUpdateOffer mockUpdateOffer;
  late MockDeleteOffer mockDeleteOffer;

  setUp(() {
    mockGetOffers = MockGetOffers();
    mockCreateOffer = MockCreateOffer();
    mockUpdateOffer = MockUpdateOffer();
    mockDeleteOffer = MockDeleteOffer();

    bloc = OfferBloc(
      getOffers: mockGetOffers,
      createOffer: mockCreateOffer,
      updateOffer: mockUpdateOffer,
      deleteOffer: mockDeleteOffer,
    );
  });

  final tOffer = Offer(
    id: '1',
    title: 'Test Offer',
    description: 'Test Description',
    discountPercentage: 10,
    originalPrice: 100,
    discountedPrice: 90,
  );

  group('GetOffersEvent', () {
    test('initial state is OfferInitial', () {
      expect(bloc.state, OfferInitial());
    });

    blocTest<OfferBloc, OfferState>(
      'emits [OfferLoading, OfferLoaded] when GetOffersEvent is added and successful',
      build: () {
        when(mockGetOffers(any)).thenAnswer((_) async => Right([tOffer]));
        return bloc;
      },
      act: (bloc) => bloc.add(GetOffersEvent()),
      expect: () => [
        OfferLoading(),
        OfferLoaded([tOffer]),
      ],
    );

    blocTest<OfferBloc, OfferState>(
      'emits [OfferLoading, OfferError] when GetOffersEvent is added and fails',
      build: () {
        when(mockGetOffers(any)).thenAnswer((_) async => Left(ServerFailure()));
        return bloc;
      },
      act: (bloc) => bloc.add(GetOffersEvent()),
      expect: () => [
        OfferLoading(),
        OfferError('Server failure'),
      ],
    );
  });

  // Add similar tests for CreateOfferEvent, UpdateOfferEvent, and DeleteOfferEvent
}

### File: integration_test/app_test.dart

import 'package:flutter_test/flutter_test.dart';
import 'package:integration_test/integration_test.dart';
import 'package:mobile_app/main.dart' as app;

void main() {
  IntegrationTestWidgetsFlutterBinding.ensureInitialized();

  group('end-to-end test', () {
    testWidgets('tap on the first offer, verify details, and go back',
        (WidgetTester tester) async {
      app.main();
      await tester.pumpAndSettle();

      // Verify that we are on the offer listing page
      expect(find.text('Special Offers'), findsOneWidget);

      // Tap on the first offer
      await tester.tap(find.byType(OfferCard).first);
      await tester.pumpAndSettle();

      // Verify that we are on the offer details page
      expect(find.byType(OfferDetailsPage), findsOneWidget);

      // Verify the presence of certain widgets on the details page
      expect(find.text('Buy Now'), findsOneWidget);

      // Go back to the listing page
      await tester.tap(find.byType(BackButton));
      await tester.pumpAndSettle();

      // Verify that we are back on the offer listing page
      expect(find.text('Special Offers'), findsOneWidget);
    });

    // Add more integration tests as needed
  });
}

